#!/usr/bin/env bash

## Node Versioning Manager
if [[ $PWD =~ .*[sS]pongy-{0,1}.* ]]; then
    source /usr/share/nvm/init-nvm.sh
    nvm use lts/carbon
fi

# MagicCD
alias cdc='_magicCD 2 $HOME/Coding/'
alias cdp='_magicCD 2 $HOME/Pokemod/'

# cool_places+=(

#     )

# Uses open-subl3 instead of plain subl3 (so it doesn't changes workspaces if there's an instance already opened)
alias subl='open-subl3'
alias subl3='open-subl3'


# Fixes kitty on ssh
if [[ $(is_ssh) && $TERM == "xterm-kitty" ]]; then
    export TERM=xterm
fi

## Dangerous stuff that interferes with scripts
## Put these at the end of your .bashrc preferably so it doesn't
## intereferes with anything that is being done there.
# Allows non case-sensitive wildcard globs (*, ?):
shopt -s nocaseglob
# Allows extended wildcard globs
shopt -s extglob
# Enables the ** glob
shopt -s globstar

## WIP:
## This makes it only actually grep if it's not being piped
## so it works for <(grep ..) or var=$(grep ..) or echo '' | grep
# grep() {
#     #
#     # Another way is using [ -t 1 ] and [ -t 0 ]
#     if { [ "$(LC_ALL=C stat -c %F - <&3)" = fifo ]; } 3>&1 || [ "$(LC_ALL=C stat -c %F -)" = fifo ]; then
#         command grep "$@"
#     else
#         command grep -n -C 2 $_COLOR_ALWAYS_ARG -E "$@"
#   fi
# }

## WIP:
# function cd() {
#     # readarray -d '' results < <(find . -maxdepth 1 -path "*node_modules*" -prune -o -type d -print0)
#     # readarray results < <(ls -x -w1)
#     readarray -d '' results < <(find "${1}/" -maxdepth 1 -path "*node_modules*" -prune -o -type d -print0)

#     # echo "${results[@]}"
#     if [[ ${#results[@]} -ge 2 && ${#results[@]} -lt 20 ]]; then
#         # Let the user choose
#         select_option "${results[@]}"
#         local option="${results[$?]}"
#         if [[ "$option" != '.' ]]; then
#             echo "$option"
#             cd "$option"
#             # cd "${results[$?]}"
#         else
#             echo "$option"
#             builtin cd "${1}"
#         fi
#     fi
#     builtin cd "${1}"
# }

# Adds coloring output for the rest of the shit
if [[ -d ~/.grc/ ]]; then
    for i in ~/.grc/*; do
        if [[ ${i//*\//} != "grc.conf" && ! $(alias "${i##*conf.}" 2>/dev/null) ]]; then
            alias "${i##*conf.}=$GRC -c ${i} ${i##*conf.}"
        fi
    done
fi

## Allows zsh-style completion for dirs
## Example:
##     cd /u/s/*comp[TAB]
_bcpp --dirs --nocase --cooperate
complete -F _bcpp_complete_dir rmdir